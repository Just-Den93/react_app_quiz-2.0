{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{loadJsonDataByMode}from'../utils/loadJsonData';import{jsx as _jsx}from\"react/jsx-runtime\";const QuizContext=/*#__PURE__*/createContext();export function useQuizContext(){return useContext(QuizContext);}export function QuizProvider(_ref){let{children}=_ref;const[showQuizPage,setShowQuizPage]=useState(()=>{const savedState=localStorage.getItem('showQuizPage');return savedState==='true';});const[selectedMode,setSelectedMode]=useState(()=>{const mode=localStorage.getItem('selectedMode');return mode||null;});const[currentQuizId,setCurrentQuizId]=useState(()=>{return localStorage.getItem('currentQuizId');});const[quizStates,setQuizStates]=useState(()=>{const savedStates=localStorage.getItem('quizStates');return savedStates?JSON.parse(savedStates):{};});const[data,setData]=useState(()=>{const savedData=localStorage.getItem('data');return savedData?JSON.parse(savedData):null;});const[completedGames,setCompletedGames]=useState(()=>{const savedGames=localStorage.getItem('completedGames');return savedGames?JSON.parse(savedGames):0;});useEffect(()=>{if(selectedMode&&currentQuizId){const selectedData=loadJsonDataByMode(selectedMode);const savedData=localStorage.getItem('data');if(selectedData&&selectedData.categories&&JSON.stringify(selectedData.categories)!==savedData){setData(selectedData.categories);updateQuizState(currentQuizId,{data:selectedData.categories});localStorage.setItem('data',JSON.stringify(selectedData.categories));}}},[selectedMode,currentQuizId]);useEffect(()=>{if(selectedMode!==null){localStorage.setItem('selectedMode',selectedMode);}},[selectedMode]);useEffect(()=>{localStorage.setItem('showQuizPage',showQuizPage.toString());},[showQuizPage]);useEffect(()=>{if(currentQuizId!==null){localStorage.setItem('currentQuizId',currentQuizId);}},[currentQuizId]);useEffect(()=>{localStorage.setItem('completedGames',completedGames.toString());},[completedGames]);const updateQuizState=(uuid,newState)=>{setQuizStates(prevStates=>{const updatedStates={...prevStates,[uuid]:{...prevStates[uuid],...newState}};localStorage.setItem('quizStates',JSON.stringify(updatedStates));return updatedStates;});};const markBlockAsUsed=(quizId,categoryId,blockId)=>{if(!categoryId){console.error('categoryId не определен, невозможно отметить блок как используемый');return;}console.log('markBlockAsUsed called for quizId:',quizId);setQuizStates(prevStates=>{const previousState=prevStates[quizId]||{};const updatedUsedBlocks={...previousState.usedBlocks};if(!updatedUsedBlocks[categoryId]){updatedUsedBlocks[categoryId]=[];}if(!updatedUsedBlocks[categoryId].includes(blockId)){updatedUsedBlocks[categoryId].push(blockId);}// Логируем прогресс использования блоков\nconsole.log('Updated used blocks:',updatedUsedBlocks);const allBlocksUsed=data.every(category=>updatedUsedBlocks[category.id]&&updatedUsedBlocks[category.id].length===category.blocks.length);// Логируем результат проверки на завершение викторины\nif(allBlocksUsed){console.log('All blocks used. Incrementing completed games.');setCompletedGames(prevGames=>prevGames+1);}const updatedStates={...prevStates,[quizId]:{...previousState,usedBlocks:updatedUsedBlocks}};localStorage.setItem('quizStates',JSON.stringify(updatedStates));localStorage.setItem(\"usedBlocks-\".concat(quizId),JSON.stringify(updatedUsedBlocks));return updatedStates;});};// Новая функция для сброса состояния и возврата в главное меню\nconst handleMainMenu=()=>{setShowQuizPage(false);setCurrentQuizId(null);// Сбрасываем текущую викторину\n};return/*#__PURE__*/_jsx(QuizContext.Provider,{value:{showQuizPage,setShowQuizPage,selectedMode,setSelectedMode,currentQuizId,setCurrentQuizId,quizStates,setQuizStates,updateQuizState,markBlockAsUsed,data,completedGames,handleMainMenu// Экспортируем функцию для возврата в главное меню\n},children:children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","loadJsonDataByMode","jsx","_jsx","QuizContext","useQuizContext","QuizProvider","_ref","children","showQuizPage","setShowQuizPage","savedState","localStorage","getItem","selectedMode","setSelectedMode","mode","currentQuizId","setCurrentQuizId","quizStates","setQuizStates","savedStates","JSON","parse","data","setData","savedData","completedGames","setCompletedGames","savedGames","selectedData","categories","stringify","updateQuizState","setItem","toString","uuid","newState","prevStates","updatedStates","markBlockAsUsed","quizId","categoryId","blockId","console","error","log","previousState","updatedUsedBlocks","usedBlocks","includes","push","allBlocksUsed","every","category","id","length","blocks","prevGames","concat","handleMainMenu","Provider","value"],"sources":["E:/quiz-app-react/src/context/QuizContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { loadJsonDataByMode } from '../utils/loadJsonData';\r\n\r\nconst QuizContext = createContext();\r\n\r\nexport function useQuizContext() {\r\n  return useContext(QuizContext);\r\n}\r\n\r\nexport function QuizProvider({ children }) {\r\n  const [showQuizPage, setShowQuizPage] = useState(() => {\r\n    const savedState = localStorage.getItem('showQuizPage');\r\n    return savedState === 'true';\r\n  });\r\n\r\n  const [selectedMode, setSelectedMode] = useState(() => {\r\n    const mode = localStorage.getItem('selectedMode');\r\n    return mode || null;\r\n  });\r\n\r\n  const [currentQuizId, setCurrentQuizId] = useState(() => {\r\n    return localStorage.getItem('currentQuizId');\r\n  });\r\n\r\n  const [quizStates, setQuizStates] = useState(() => {\r\n    const savedStates = localStorage.getItem('quizStates');\r\n    return savedStates ? JSON.parse(savedStates) : {};\r\n  });\r\n\r\n  const [data, setData] = useState(() => {\r\n    const savedData = localStorage.getItem('data');\r\n    return savedData ? JSON.parse(savedData) : null;\r\n  });\r\n\r\n  const [completedGames, setCompletedGames] = useState(() => {\r\n    const savedGames = localStorage.getItem('completedGames');\r\n    return savedGames ? JSON.parse(savedGames) : 0;\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (selectedMode && currentQuizId) {\r\n      const selectedData = loadJsonDataByMode(selectedMode);\r\n      const savedData = localStorage.getItem('data');\r\n\r\n      if (selectedData && selectedData.categories && JSON.stringify(selectedData.categories) !== savedData) {\r\n        setData(selectedData.categories);\r\n        updateQuizState(currentQuizId, { data: selectedData.categories });\r\n        localStorage.setItem('data', JSON.stringify(selectedData.categories));\r\n      }\r\n    }\r\n  }, [selectedMode, currentQuizId]);\r\n\r\n  useEffect(() => {\r\n    if (selectedMode !== null) {\r\n      localStorage.setItem('selectedMode', selectedMode);\r\n    }\r\n  }, [selectedMode]);\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('showQuizPage', showQuizPage.toString());\r\n  }, [showQuizPage]);\r\n\r\n  useEffect(() => {\r\n    if (currentQuizId !== null) {\r\n      localStorage.setItem('currentQuizId', currentQuizId);\r\n    }\r\n  }, [currentQuizId]);\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('completedGames', completedGames.toString());\r\n  }, [completedGames]);\r\n\r\n  const updateQuizState = (uuid, newState) => {\r\n    setQuizStates((prevStates) => {\r\n      const updatedStates = {\r\n        ...prevStates,\r\n        [uuid]: {\r\n          ...prevStates[uuid],\r\n          ...newState,\r\n        },\r\n      };\r\n      localStorage.setItem('quizStates', JSON.stringify(updatedStates));\r\n      return updatedStates;\r\n    });\r\n  };\r\n\r\n  const markBlockAsUsed = (quizId, categoryId, blockId) => {\r\n    if (!categoryId) {\r\n      console.error('categoryId не определен, невозможно отметить блок как используемый');\r\n      return;\r\n    }\r\n  \r\n    console.log('markBlockAsUsed called for quizId:', quizId);\r\n  \r\n    setQuizStates((prevStates) => {\r\n      const previousState = prevStates[quizId] || {};\r\n      const updatedUsedBlocks = { ...previousState.usedBlocks };\r\n  \r\n      if (!updatedUsedBlocks[categoryId]) {\r\n        updatedUsedBlocks[categoryId] = [];\r\n      }\r\n  \r\n      if (!updatedUsedBlocks[categoryId].includes(blockId)) {\r\n        updatedUsedBlocks[categoryId].push(blockId);\r\n      }\r\n  \r\n      // Логируем прогресс использования блоков\r\n      console.log('Updated used blocks:', updatedUsedBlocks);\r\n  \r\n      const allBlocksUsed = data.every(category =>\r\n        updatedUsedBlocks[category.id] &&\r\n        updatedUsedBlocks[category.id].length === category.blocks.length\r\n      );\r\n  \r\n      // Логируем результат проверки на завершение викторины\r\n      if (allBlocksUsed) {\r\n        console.log('All blocks used. Incrementing completed games.');\r\n        setCompletedGames((prevGames) => prevGames + 1);\r\n      }\r\n  \r\n      const updatedStates = {\r\n        ...prevStates,\r\n        [quizId]: {\r\n          ...previousState,\r\n          usedBlocks: updatedUsedBlocks,\r\n        },\r\n      };\r\n  \r\n      localStorage.setItem('quizStates', JSON.stringify(updatedStates));\r\n      localStorage.setItem(`usedBlocks-${quizId}`, JSON.stringify(updatedUsedBlocks));\r\n  \r\n      return updatedStates;\r\n    });\r\n  };\r\n  \r\n\r\n  // Новая функция для сброса состояния и возврата в главное меню\r\n  const handleMainMenu = () => {\r\n    setShowQuizPage(false);\r\n    setCurrentQuizId(null); // Сбрасываем текущую викторину\r\n  };\r\n\r\n  return (\r\n    <QuizContext.Provider value={{\r\n      showQuizPage,\r\n      setShowQuizPage,\r\n      selectedMode,\r\n      setSelectedMode,\r\n      currentQuizId,\r\n      setCurrentQuizId,\r\n      quizStates,\r\n      setQuizStates,\r\n      updateQuizState,\r\n      markBlockAsUsed,\r\n      data,\r\n      completedGames,\r\n      handleMainMenu // Экспортируем функцию для возврата в главное меню\r\n    }}>\r\n      {children}\r\n    </QuizContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}